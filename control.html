<!DOCTYPE html>
<html>
<head>
  <title>Control Panel</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>
  <title>Control Panel</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 20px;
      background-color: #f9f9f9;
    }

    input, button {
      padding: 10px;
      margin: 5px;
      font-size: 16px;
    }

    h1 {
      color: #333;
    }

    #display {
      font-size: 48px;
      margin: 20px 0;
    }

    #roundDisplay {
      font-size: 24px;
      color: #555;
    }
  </style>


</head>
<body>
  <h1>Control Panel</h1>

  <label for="startTime">Set countdown (menit):</label>
  <input type="number" id="startTime" value="3" min="1" max="60">
  <br><br>

  <button onclick="startTimer()">Start</button>
  <button onclick="pauseTimer()">Pause</button>
  <button onclick="resetTimer()">Reset</button>
  <button onclick="previousRound()">Previous Round</button>
  <button onclick="nextRound()">Next Round</button>

  <h2 id="display">00:00</h2>
  <h3 id="roundDisplay">Round 1</h3>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDT-K7hjdiH8boL2nvWYrCAhBlp5CJFuHE",
      authDomain: "timer-514d6.firebaseapp.com",
      databaseURL: "https://timer-514d6-default-rtdb.asia-southeast1.firebasedatabase.app/",
      projectId: "timer-514d6",
      storageBucket: "timer-514d6.appspot.com",
      messagingSenderId: "513946831502",
      appId: "1:513946831502:web:30865a744e0790f77fd7df",
      measurementId: "G-33F3H7M3Y8"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    let timer;
    let time = 0;
    let countdownStart = 180;
    let round = 1;

    function updateDisplay() {
      const minutes = String(Math.floor(time / 60)).padStart(2, '0');
      const seconds = String(time % 60).padStart(2, '0');
      document.getElementById("display").textContent = `${minutes}:${seconds}`;
      document.getElementById("roundDisplay").textContent = `Round ${round}`;
    }

    function updateFirebase() {
      set(ref(db, "game"), {
        time: time,
        round: round
      });
    }

    function startTimer() {
      if (!timer) {
        timer = setInterval(() => {
          if (time > 0) {
            time--;
            updateDisplay();
            updateFirebase();
          } else {
            clearInterval(timer);
            timer = null;
          }
        }, 1000);
      }
    }

    function pauseTimer() {
      clearInterval(timer);
      timer = null;
    }

    function resetTimer() {
      pauseTimer();
      const inputMinutes = parseInt(document.getElementById("startTime").value, 10) || 1;
      countdownStart = inputMinutes * 60;
      time = countdownStart;
      updateDisplay();
      updateFirebase();
    }

    function nextRound() {
      round++;
      updateFirebase();
      document.getElementById("roundDisplay").textContent = `Round ${round}`;
    }

    function previousRound() {
      if (round > 1) round--;
      updateFirebase();
      document.getElementById("roundDisplay").textContent = `Round ${round}`;
    }

    // Init saat halaman dibuka
    window.onload = () => {
      resetTimer();
    };
  </script>
</body>
</html>
